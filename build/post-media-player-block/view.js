import*as e from"@wordpress/interactivity";var i={d:(e,a)=>{for(var t in a)i.o(a,t)&&!i.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:a[t]})},o:(e,i)=>Object.prototype.hasOwnProperty.call(e,i)};const a=(t={getContext:()=>e.getContext,getElement:()=>e.getElement,store:()=>e.store},o={},i.d(o,t),o);var t,o;function r(e){let i=Math.floor(e/3600),a=Math.floor((e-3600*i)/60);return[i,a,e=e-3600*i-60*a]}function d(e,i=e){let a=i.slice(i.findIndex((e=>0!==e)));return e.slice(e.length-a.length).map((e=>e.toString().padStart(2,"0"))).join(":")}const{state:n,actions:l}=(0,a.store)("ncmfse/post-media-player-block",{state:{get audioEpisode(){return"AUDIO"!==n.initEpisode?.media?.type?null:n.initEpisode},get videoEpisode(){return"VIDEO"!==n.initEpisode?.media?.type?null:n.initEpisode},get iframeEpisode(){return"IFRAME"!==n.initEpisode?.media?.type?null:n.initEpisode},get mediaIsIframe(){return"IFRAME"===n.initEpisode?.media?.type},get mediaIsVideo(){return"VIDEO"===n.initEpisode?.media?.type},get mediaIsAudio(){return"AUDIO"===n.initEpisode?.media?.type},get playedWidth(){return`calc(${n.currentTime/n.duration*100}% -  0.25rem)`},get thumbLeft(){return`calc(${n.currentTime/n.duration*100}%)`},get currentTimeHuman(){return d(r(n.currentTime),r(n.duration))},get durationHuman(){return d(r(n.duration))},get isPlaybackRate1x(){return 1===n.playbackRate},get isPlaybackRate1_5x(){return 1.5===n.playbackRate},get isPlaybackRate2x(){return 2===n.playbackRate},get isCurrentPostPlaying(){const e=(0,a.getContext)();return e.episodeContext?.id===n.initEpisode?.id&&("AUDIO"===n.initEpisode?.media?.type?n.playing:n.videoPlaying)}},actions:{dispatchPlay(){n.playing=!0},dispatchPause(){n.playing=!1},dispatchDurationChange(){const{playerRef:e}=n;n.duration=Math.floor(e?.duration||0)},dispatchCurrentTimeChange(){const{playerRef:e}=n;n.currentTime=Math.floor(e?.currentTime||0)},play(){const{audioEpisode:e,playerRef:i,currentPlayingId:a}=n;if(e&&(n.playing=!0,i&&a!==e?.id)){let e=i.playbackRate;i.load(),i.pause(),i.playbackRate=e,i.currentTime=0}n.isShowAudioPlayer=!0,n.isShowVideoPlayer=!1,i?.play(),n.currentPlayingId=e?.id||null},pause(){const{playerRef:e}=n;e?.pause()},toggle(){l.isPlaying()?l.pause():l.play()},toggleMute(){n.muted=!n.muted},isPlaying(){const{playerRef:e,audioEpisode:i,currentPlayingId:a}=n;return!!i&&n.playing&&e?.currentSrc&&a===i?.id},rewind10s(){const{playerRef:e}=n;e&&(e.currentTime+=-10)},forward10s(){const{playerRef:e}=n;e&&(e.currentTime+=10)},togglePlaybackRate(){const{playerRef:e}=n;e&&(1===n.playbackRate?n.playbackRate=1.5:1.5===n.playbackRate?n.playbackRate=2:n.playbackRate=1,e.playbackRate=n.playbackRate)},forceEnd(){const{playerRef:e}=n;n.initEpisode=null,n.playing=!1,e&&(e.currentTime=0,e.pause(),n.currentPlayingId=null)},handleSeekMouseDown(){const{playerRef:e}=n;e?.pause()},handleSeekChange(){const{playerRef:e,sliderRef:i}=n;if(!e?.currentSrc||!i)return;const a=e.duration*parseFloat(i.value);n.currentTime=Math.floor(a),e.currentTime=Math.floor(a)},handleSeekMouseUp(){const{playerRef:e}=n;e?.play()},dispatchVideoPlay(){n.videoPlaying=!0},dispatchVideoPause(){n.videoPlaying=!1},dispatchVideoCurrentTimeChange(){const{videoPlayerRef:e}=n;n.videoCurrentTime=Math.floor(e?.currentTime||0)},dispatchVideoVolumeChange(){const{videoPlayerRef:e}=n;n.videoMuted=e?.muted,n.videoVolume=e?.volume},dispatchVideoPlaybackRateChange(){const{videoPlayerRef:e}=n;n.videoPlaybackRate=e?.playbackRate},videoPlay(){const{videoEpisode:e,videoPlayerRef:i,currentPlayingId:a}=n;e&&i&&a!==e?.id&&(i.load(),i.pause(),i.playbackRate=1,i.currentTime=0,i.volume=1,i.muted=!1),n.videoPlaying=!0,n.isShowVideoPlayer=!0,n.isShowAudioPlayer=!1,i?.play(),n.currentPlayingId=e?.id||null},videoPause(){const{videoPlayerRef:e}=n;e?.pause()},videoToggle(){l.isVideoPlaying()?l.videoPause():l.videoPlay()},isVideoPlaying(){const{videoPlayerRef:e,videoEpisode:i,currentPlayingId:a}=n;return!!i&&n.videoPlaying&&e?.currentSrc&&a===i?.id},forceVideoEnd(){n.initEpisode=null,n.videoPlaying=!1,n.videoPlayerRef&&(n.videoPlayerRef.currentTime=0,n.videoPlayerRef.pause(),n.currentPlayingId=null)},videoIframePlay(){n.isShowAudioPlayer=!1,n.isShowVideoPlayer=!0,n.videoPlaying=!0},forceVideoIframeEnd(){n.initEpisode=null,n.videoPlaying=!1},handleClickPostMediaPlayBtn(){const e=(0,a.getContext)();if(console.log("click - episodeContext",e.episodeContext),Object.values(e.episodeContext?.media?.urls||{}).every((e=>!e)))return void console.log("urls is empty");if(e.episodeContext?.id===n.currentPlayingId)return void(n.mediaIsVideo?l.videoToggle():n.mediaIsIframe?l.videoIframePlay():n.mediaIsAudio&&l.toggle());l.forceEnd(),l.forceVideoEnd(),l.forceVideoIframeEnd(),n.initEpisode=e.episodeContext||null;const i=e.episodeContext?.media?.type;"AUDIO"!==i?"VIDEO"!==i?"IFRAME"!==i||l.videoIframePlay():l.videoPlay():l.play()},handleCloseAllPlayer(){n.isShowAudioPlayer=!1,n.isShowVideoPlayer=!1,l.forceEnd(),l.forceVideoEnd(),l.forceVideoIframeEnd(),n.initEpisode=null,n.currentPlayingId=null,n.duration=0,n.currentTime=0,n.playing=!1,n.muted=!1,n.playbackRate=1}},callbacks:{onInit:()=>{const{ref:e}=(0,a.getElement)();n.playerRef=e?.querySelector("audio#ncmazfse-media-player-audio"),n.sliderRef=e?.querySelector("input#ncmazfse-media-player-audio-slider-input"),n.videoPlayerRef=e?.querySelector("video#ncmazfse-media-player-video");const i=JSON.parse(localStorage.getItem("ncmazfse_media_player_current_state")||"");i?.initEpisode?.id&&(n.initEpisode=i.initEpisode,n.isShowAudioPlayer=i.isShowAudioPlayer,n.isShowVideoPlayer=i.isShowVideoPlayer,n.currentPlayingId=i.currentPlayingId,"AUDIO"===i.initEpisode?.media?.type&&n.playerRef?(n.muted=i.muted,n.duration=i.duration,n.currentTime=i.currentTime,n.playbackRate=i.playbackRate,n.playerRef.load(),n.playerRef.currentTime=i.currentTime,n.playerRef.playbackRate=i.playbackRate,n.playerRef.muted=i.muted):"VIDEO"===i.initEpisode?.media?.type&&n.videoPlayerRef&&(n.videoPlayerRef.load(),n.videoPlayerRef.currentTime=i.videoCurrentTime||0,n.videoPlayerRef.playbackRate=i.videoPlaybackRate||1,n.videoPlayerRef.muted=!!i.videoMuted,n.videoPlayerRef.volume=i.videoVolume||1)),window.addEventListener("beforeunload",(()=>{const e={initEpisode:n.initEpisode,muted:n.muted,duration:n.duration,currentTime:n.currentTime,playbackRate:n.playbackRate,videoCurrentTime:n.videoCurrentTime,videoMuted:n.videoMuted,videoVolume:n.videoVolume,videoPlaybackRate:n.videoPlaybackRate,isShowAudioPlayer:n.isShowAudioPlayer,isShowVideoPlayer:n.isShowVideoPlayer,currentPlayingId:n.currentPlayingId};if("IFRAME"===n.initEpisode?.media?.type&&(e.currentPlayingId=null,n.initEpisode?.media?.urls?.media_url_iframe)){const i=new URL(n.initEpisode?.media?.urls?.media_url_iframe);i.searchParams.delete("autoplay"),i.searchParams.delete("auto_play"),e.initEpisode={...n.initEpisode,media:{...n.initEpisode.media,urls:{...n.initEpisode.media.urls||{},media_url_iframe:i.toString()}}}}localStorage.setItem("ncmazfse_media_player_current_state",JSON.stringify(e))}))}}});