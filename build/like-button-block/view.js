import*as t from"@wordpress/interactivity";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const o=(i={getContext:()=>t.getContext,store:()=>t.store},s={},e.d(s,i),s),{state:n}=(0,o.store)("ncmazfse-core/like-button",{state:{get isLiked(){const{contextIsLiked:t,postId:e}=(0,o.getContext)();return n.likeData?.[e]?n.likeData[e].isLiked:t},get likeCount(){const{contextLikeCount:t,postId:e}=(0,o.getContext)();return n.likeData?.[e]?n.likeData[e].likeCount:t},get isLoading(){const{postId:t}=(0,o.getContext)();return n.loadingList.includes(t)}},actions:{handleLike:()=>{const t=(0,o.getContext)(),{postId:e}=t;try{n.loadingList.push(e);const o=new FormData;o.append("action","handle_like"),o.append("_ajax_nonce",n.likeButtonNonce),o.append("post_id",e.toString()),o.append("user_id",n.userId.toString()),o.append("handle",n.isLiked?"remove":"add"),fetch(n.ajaxUrl,{method:"POST",body:o}).then((t=>t.json())).then((({data:o,success:i})=>{if(!i)throw new Error("Server error");const s=Boolean(o.is_liked);let a=0;if(s?a=t.contextLikeCount+1:t.contextLikeCount>0&&(a=t.contextLikeCount-1),t.contextLikeCount=a,t.contextIsLiked=s,n.likeData={...n.likeData,[e]:{likeCount:a,isLiked:s}},!n.userId){const t=localStorage.getItem("likedPosts"),o=t?JSON.parse(t):[];if(s)o.push(e);else{const t=o.indexOf(e);t>-1&&o.splice(t,1)}localStorage.setItem("likedPosts",JSON.stringify(o))}})).finally((()=>{n.loadingList=n.loadingList.filter((t=>t!==e))}))}catch(t){console.log("Error Server data!",t),n.loadingList=n.loadingList.filter((t=>t!==e))}}},callbacks:{logHandleLikeInit:()=>{const t=(0,o.getContext)();if(!n.userId){const e=localStorage.getItem("likedPosts"),o=e?JSON.parse(e):[];t.contextIsLiked=o.includes(t.postId)}}}});var i,s;